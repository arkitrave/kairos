<!DOCTYPE html><html lang="en"><head><title>kairos_collection</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content=""><meta name="groc-document-path" content="kairos_collection"><meta name="groc-project-path" content="lib/kairos_collection.js"><link rel="stylesheet" type="text/css" media="all" href="assets/style.css"><script type="text/javascript" src="assets/behavior.js"></script><body><div id="meta"><div class="file-path">lib/kairos_collection.js</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="cm">/*global _: false, KairosTimeFrame: false, KairosErrors: false, define: false, require: false, exports: false */</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">privateKey</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span>
    <span class="nx">root</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

  <span class="kd">function</span> <span class="nx">LogChannel</span> <span class="p">(</span><span class="nx">channel</span><span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Have to do some fancy shit here since all the console methods are native,
you can't use apply on them in all browsers and you can't alias them in
all browsers.</p></div></div><div class="code"><div class="wrapper">    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">console</span> <span class="o">&amp;&amp;</span> <span class="nx">console</span><span class="p">[</span><span class="nx">channel</span><span class="p">])</span> <span class="p">{</span> <span class="c1">// Allow late binding, e.g. Firebug</span>
        <span class="nx">args</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">splice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">===</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Handle the simple use-case first, to avoid the possibility of an error, and the associated overhead</span>
          <span class="nx">console</span><span class="p">[</span><span class="nx">channel</span><span class="p">](</span><span class="nx">text</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">try</span> <span class="p">{</span> <span class="c1">// This part is in a try-catch since in several browsers, you&#39;re not allowed to use apply on a native method</span>
            <span class="nx">console</span><span class="p">[</span><span class="nx">channel</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">[].</span><span class="nx">splice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
          <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// In those cases, just dump the args</span>
            <span class="nx">console</span><span class="p">[</span><span class="nx">channel</span><span class="p">](</span><span class="nx">text</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">create</span> <span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">KairosTimeFrame</span><span class="p">,</span> <span class="nx">errors</span><span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments doc-section doc-section-private"><div class="wrapper"><p><span class='doc-section-header'>Private method wireupSubscriptions</span></p>

<p>Wires up began/ended/ticked/muted/unmuted proxy subscriptions for a frame.</p>

<p>Parameters:</p>

<ul>
<li><strong>frame must be a KairosTimeFrame.</strong></li>
</ul></div></div><div class="code"><div class="wrapper">    <span class="kd">function</span> <span class="nx">wireupSubscriptions</span> <span class="p">(</span><span class="nx">frame</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

      <span class="nx">frame</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;began&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ev</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;timeFrameBegan&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">ev</span><span class="p">]);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">timeFrameName</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">timeFrameName</span> <span class="o">+</span> <span class="s1">&#39;/began&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">ev</span><span class="p">]);</span>
        <span class="p">}</span>
      <span class="p">});</span>

      <span class="nx">frame</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;ended&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ev</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;timeFrameEnded&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">ev</span><span class="p">]);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">timeFrameName</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">timeFrameName</span> <span class="o">+</span> <span class="s1">&#39;/ended&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">ev</span><span class="p">]);</span>
        <span class="p">}</span>
      <span class="p">});</span>

      <span class="nx">frame</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;ticked&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ev</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;timeFrameTicked&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">ev</span><span class="p">]);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">timeFrameName</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">timeFrameName</span> <span class="o">+</span> <span class="s1">&#39;/ticked&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">ev</span><span class="p">]);</span>
        <span class="p">}</span>
      <span class="p">});</span>

      <span class="nx">frame</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;muted&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ev</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;timeFrameMuted&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">ev</span><span class="p">]);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">timeFrameName</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">timeFrameName</span> <span class="o">+</span> <span class="s1">&#39;/muted&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">ev</span><span class="p">]);</span>
        <span class="p">}</span>
      <span class="p">});</span>

      <span class="nx">frame</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;unmuted&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ev</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;timeFrameUnmuted&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">ev</span><span class="p">]);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">timeFrameName</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">timeFrameName</span> <span class="o">+</span> <span class="s1">&#39;/unmuted&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">ev</span><span class="p">]);</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments doc-section doc-section-public"><div class="wrapper"><p><span class='doc-section-header'>Public constructor KairosCollection constructor</span></p>

<p>Creates a collection of time frames.</p>

<p>Parameters:</p>

<ul>
<li><strong>frames can be an Array of KairosTimeFrames or an Array of Objects.</strong></li>
</ul>

<p><strong>Can throw a DuplicateError</strong></p>

<p>Example:</p>

<pre><code>myCollection = new KairosCollection([
  new KairosTimeFrame('foo'),
  new KairosTimeFrame({
    beginsAt: 'now'
  }),
  {
    beginsAt: 'epoch'
  }
]).start()
</code></pre></div></div><div class="code"><div class="wrapper">    <span class="kd">function</span> <span class="nx">KairosCollection</span> <span class="p">(</span><span class="nx">frames</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;Creating a new Kairos Collection&#39;</span><span class="p">);</span>

      <span class="kd">var</span>
        <span class="nx">privateData</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">frames</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">frames</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">frame</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">frame</span> <span class="k">instanceof</span> <span class="nx">KairosTimeFrame</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">frame</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="k">return</span> <span class="k">new</span> <span class="nx">KairosTimeFrame</span><span class="p">(</span><span class="nx">frame</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}),</span>
          <span class="nx">notifyChannels</span><span class="o">:</span> <span class="p">{}</span>
        <span class="p">},</span>
        <span class="nx">names</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">compact</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="nx">privateData</span><span class="p">.</span><span class="nx">frames</span><span class="p">,</span> <span class="s1">&#39;getName&#39;</span><span class="p">));</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">names</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="nx">_</span><span class="p">.</span><span class="nx">unique</span><span class="p">(</span><span class="nx">names</span><span class="p">).</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">errors</span><span class="p">.</span><span class="nx">DuplicateError</span><span class="p">(</span><span class="s1">&#39;Duplicate names found&#39;</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">privateData</span><span class="p">.</span><span class="nx">frames</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">wireupSubscriptions</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span></div></div></div><div class="segment"><div class="comments doc-section doc-section-private"><div class="wrapper"><p><span class='doc-section-header'>Private method _private</span></p>

<p>Our private data needs to be accessible from our prototypes, but not be
accessible otherwise. We accomplish this using a lock &amp; key.</p>

<p>Parameters:</p>

<ul>
<li><strong>key must be a String.</strong></li>
</ul>

<p><strong>Returns an Object</strong><br/><strong>and</strong> <strong>Can throw an AccessDenied</strong></p></div></div><div class="code"><div class="wrapper">      <span class="k">this</span><span class="p">.</span><span class="nx">_private</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">key</span> <span class="o">===</span> <span class="nx">privateKey</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">privateData</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">errors</span><span class="p">.</span><span class="nx">AccessDenied</span><span class="p">();</span>
      <span class="p">};</span>
    <span class="p">}</span>

    <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">KairosCollection</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments doc-section doc-section-public"><div class="wrapper"><p><span class='doc-section-header'>Public method start</span></p>

<p>Starts each frame in the collection.</p>

<p><strong>Returns a KairosCollection</strong></p></div></div><div class="code"><div class="wrapper">      <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_private</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">).</span><span class="nx">frames</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">);</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">},</span></div></div></div><div class="segment"><div class="comments doc-section doc-section-public"><div class="wrapper"><p><span class='doc-section-header'>Public method stop</span></p>

<p>Stops each frame in the collection.</p>

<p><strong>Returns a KairosCollection</strong></p></div></div><div class="code"><div class="wrapper">      <span class="nx">stop</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_private</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">).</span><span class="nx">frames</span><span class="p">,</span> <span class="s1">&#39;stop&#39;</span><span class="p">);</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">},</span></div></div></div><div class="segment"><div class="comments doc-section doc-section-public"><div class="wrapper"><p><span class='doc-section-header'>Public method mute</span></p>

<p>Mutes each frame in the collection.</p>

<p><strong>Returns a KairosCollection</strong></p></div></div><div class="code"><div class="wrapper">      <span class="nx">mute</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_private</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">).</span><span class="nx">frames</span><span class="p">,</span> <span class="s1">&#39;mute&#39;</span><span class="p">);</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">},</span></div></div></div><div class="segment"><div class="comments doc-section doc-section-public"><div class="wrapper"><p><span class='doc-section-header'>Public method unmute</span></p>

<p>Unmutes each frame in the collection.</p>

<p><strong>Returns a KairosCollection</strong></p></div></div><div class="code"><div class="wrapper">      <span class="nx">unmute</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_private</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">).</span><span class="nx">frames</span><span class="p">,</span> <span class="s1">&#39;unmute&#39;</span><span class="p">);</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">},</span></div></div></div><div class="segment"><div class="comments doc-section doc-section-public"><div class="wrapper"><p><span class='doc-section-header'>Public method subscribe</span></p>

<p>Subscribes a function to a given channel.</p>

<p>Parameters:</p>

<ul>
<li><p><strong>channel must be a String.</strong></p></li>
<li><p><strong>fn must be a Function.</strong></p></li>
</ul>

<p><strong>Returns a KairosCollection</strong></p>

<p>Example:</p>

<pre><code>myCollection.subscribe('foo', function (bar) { ... }
</code></pre></div></div><div class="code"><div class="wrapper">      <span class="nx">subscribe</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">notifyChannels</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_private</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">).</span><span class="nx">notifyChannels</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">notifyChannels</span><span class="p">[</span><span class="nx">channel</span><span class="p">])</span> <span class="p">{</span>
          <span class="nx">notifyChannels</span><span class="p">[</span><span class="nx">channel</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="p">}</span>
        <span class="nx">notifyChannels</span><span class="p">[</span><span class="nx">channel</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">fn</span><span class="p">);</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">},</span></div></div></div><div class="segment"><div class="comments doc-section doc-section-public"><div class="wrapper"><p><span class='doc-section-header'>Public method publish</span></p>

<p>Publishes an event on a given channel.</p>

<p>Parameters:</p>

<ul>
<li><p><strong>channel must be a String.</strong></p></li>
<li><p><strong>args is optional and can be of any type.</strong></p></li>
<li><p><strong>scope is optional and must be an Object.</strong></p></li>
</ul>

<p><strong>Returns a KairosCollection</strong></p>

<p>Example:</p>

<pre><code>myCollection.publish('foo', bar);
</code></pre></div></div><div class="code"><div class="wrapper">      <span class="nx">publish</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">scope</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span>
          <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
          <span class="nx">notifyChannels</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_private</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">).</span><span class="nx">notifyChannels</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">notifyChannels</span><span class="p">[</span><span class="nx">channel</span><span class="p">])</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">args</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">args</span> <span class="o">=</span> <span class="p">[</span><span class="nx">args</span><span class="p">];</span>
          <span class="p">}</span>

          <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">notifyChannels</span><span class="p">[</span><span class="nx">channel</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
              <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">self</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">});</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">},</span></div></div></div><div class="segment"><div class="comments doc-section doc-section-public"><div class="wrapper"><p><span class='doc-section-header'>Public method unsubscribe</span></p>

<p>Unsubscribes a function from a given channel.</p>

<p>Parameters:</p>

<ul>
<li><strong>handle can be of any type.</strong></li>
</ul>

<p><strong>Returns a KairosCollection</strong></p>

<p>Example:</p>

<pre><code>myCollection.unsubscribe(['foo', fooFn])
</code></pre></div></div><div class="code"><div class="wrapper">      <span class="nx">unsubscribe</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">handle</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span>
          <span class="nx">notifyChannels</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_private</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">).</span><span class="nx">notifyChannels</span><span class="p">,</span>
          <span class="nx">channel</span> <span class="o">=</span> <span class="nx">handle</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
          <span class="nx">fn</span> <span class="o">=</span> <span class="nx">handle</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
          <span class="nx">i</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">notifyChannels</span><span class="p">[</span><span class="nx">channel</span><span class="p">])</span> <span class="p">{</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">notifyChannels</span><span class="p">[</span><span class="nx">channel</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">notifyChannels</span><span class="p">[</span><span class="nx">channel</span><span class="p">][</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">notifyChannels</span><span class="p">[</span><span class="nx">channel</span><span class="p">].</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">},</span></div></div></div><div class="segment"><div class="comments doc-section doc-section-public"><div class="wrapper"><p><span class='doc-section-header'>Public method toJSON </span></p>

<p>Returns a representation of this collection suitable for json
serialization.</p>

<p>TODO: </p>

<p><strong>Returns an Object</strong></p></div></div><div class="code"><div class="wrapper">      <span class="nx">toJSON</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{};</span>
      <span class="p">},</span> <span class="c1">// TODO</span></div></div></div><div class="segment"><div class="comments doc-section doc-section-public"><div class="wrapper"><p><span class='doc-section-header'>Public method toString</span></p>

<p>Returns a string representation of this time frame.</p>

<p><strong>Returns a String</strong></p></div></div><div class="code"><div class="wrapper">      <span class="nx">toString</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">toJson</span><span class="p">(),</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
      <span class="p">},</span>

      <span class="nx">logger</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">log</span><span class="o">:</span>   <span class="k">new</span> <span class="nx">LogChannel</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">),</span>
        <span class="nx">info</span><span class="o">:</span>  <span class="k">new</span> <span class="nx">LogChannel</span><span class="p">(</span><span class="s1">&#39;info&#39;</span><span class="p">),</span>
        <span class="nx">debug</span><span class="o">:</span> <span class="k">new</span> <span class="nx">LogChannel</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span><span class="p">),</span>
        <span class="nx">warn</span><span class="o">:</span>  <span class="k">new</span> <span class="nx">LogChannel</span><span class="p">(</span><span class="s1">&#39;warn&#39;</span><span class="p">),</span>
        <span class="nx">error</span><span class="o">:</span> <span class="k">new</span> <span class="nx">LogChannel</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
      <span class="p">},</span></div></div></div><div class="segment"><div class="comments doc-section doc-section-public"><div class="wrapper"><p><span class='doc-section-header'>Public method extendNamedTimes</span></p>

<p>Extends the set of named times in each frame.</p>

<p>Parameters:</p>

<ul>
<li><strong>obj must be an Object.</strong></li>
</ul>

<p><strong>Returns a KairosCollection</strong><br/><strong>and</strong> <strong>Can throw a MissingParameter or an ImmutableError</strong></p>

<p>Example:</p>

<pre><code>myCollection.extendNamedTimes({
  foo: new Date('1234-05-06')
})
</code></pre></div></div><div class="code"><div class="wrapper">      <span class="nx">extendNamedTimes</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_private</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">).</span><span class="nx">frames</span><span class="p">,</span> <span class="s1">&#39;extendNamedTimes&#39;</span><span class="p">,</span> <span class="nx">obj</span><span class="p">);</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">},</span></div></div></div><div class="segment"><div class="comments doc-section doc-section-public"><div class="wrapper"><p><span class='doc-section-header'>Public method pushTimeFrame</span></p>

<p>Adds a time frame to the collection.</p>

<p>Parameters:</p>

<ul>
<li><strong>frame can be a KairosTimeFrame or an Object.</strong></li>
</ul>

<p><strong>Returns a KairosCollection</strong></p>

<p>Example:</p>

<pre><code>myCollection.pushTimeFrame(new KairosTimeFrame())
myCollection.pushTimeFrame({
  beginsAt: 'noon'
  })
</code></pre></div></div><div class="code"><div class="wrapper">      <span class="nx">pushTimeFrame</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">frame</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">frame</span> <span class="k">instanceof</span> <span class="nx">KairosTimeFrame</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">frame</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">KairosTimeFrame</span><span class="p">(</span><span class="nx">frame</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;Adding new Time Frame&#39;</span><span class="p">,</span> <span class="nx">frame</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">_private</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">).</span><span class="nx">frames</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">frame</span><span class="p">);</span>

        <span class="nx">wireupSubscriptions</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">frame</span><span class="p">);</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">},</span></div></div></div><div class="segment"><div class="comments doc-section doc-section-public"><div class="wrapper"><p><span class='doc-section-header'>Public method getTimeFrames</span></p>

<p>Gets all of the time frames in the collection.</p>

<p><strong>Returns a KairosTimeFrame[]</strong></p></div></div><div class="code"><div class="wrapper">      <span class="nx">getTimeFrames</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_private</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">).</span><span class="nx">frames</span><span class="p">);</span>
      <span class="p">},</span></div></div></div><div class="segment"><div class="comments doc-section doc-section-public"><div class="wrapper"><p><span class='doc-section-header'>Public method getNamedTimeFrame</span></p>

<p>Finds a single time frame by name.</p>

<p>Parameters:</p>

<ul>
<li><strong>name must be a String.</strong></li>
</ul>

<p><strong>Returns a KairosTimeFrame</strong><br/><strong>and</strong> <strong>Can throw a MissingParameter</strong></p></div></div><div class="code"><div class="wrapper">      <span class="nx">getNamedTimeFrame</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="nx">errors</span><span class="p">.</span><span class="nx">MissingParameter</span><span class="p">(</span><span class="s1">&#39;No name was provided&#39;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_private</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">).</span><span class="nx">frames</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">frame</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">frame</span><span class="p">.</span><span class="nx">getName</span><span class="p">()</span> <span class="o">===</span> <span class="nx">name</span><span class="p">;</span>
          <span class="p">});</span>
        <span class="p">}</span>
      <span class="p">},</span>

      <span class="nx">version</span><span class="o">:</span> <span class="s1">&#39;@@version&#39;</span>
    <span class="p">});</span>

    <span class="nx">KairosCollection</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toJson</span> <span class="o">=</span> <span class="nx">KairosCollection</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">;</span>

    <span class="nx">KairosCollection</span><span class="p">.</span><span class="nx">version</span> <span class="o">=</span> <span class="s1">&#39;@@version&#39;</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">KairosCollection</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;function&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">define</span> <span class="o">&amp;&amp;</span> <span class="nx">define</span><span class="p">.</span><span class="nx">amd</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">define</span><span class="p">(</span><span class="s1">&#39;kairos_collection&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;underscore&#39;</span><span class="p">,</span> <span class="s1">&#39;kairos_time_frame&#39;</span><span class="p">,</span> <span class="s1">&#39;kairos_errors&#39;</span><span class="p">],</span> <span class="nx">create</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">exports</span><span class="p">.</span><span class="nx">KairosCollection</span> <span class="o">=</span> <span class="nx">create</span><span class="p">(</span>
      <span class="p">(</span><span class="s1">&#39;function&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">require</span> <span class="o">&amp;&amp;</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;underscore&#39;</span><span class="p">))</span>                          <span class="o">||</span> <span class="nx">exports</span><span class="p">.</span><span class="nx">_</span>               <span class="o">||</span> <span class="nx">_</span><span class="p">,</span>
      <span class="p">(</span><span class="s1">&#39;function&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">require</span> <span class="o">&amp;&amp;</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./kairos_time_frame&#39;</span><span class="p">).</span><span class="nx">KairosTimeFrame</span><span class="p">)</span> <span class="o">||</span> <span class="nx">exports</span><span class="p">.</span><span class="nx">KairosTimeFrame</span> <span class="o">||</span> <span class="nx">KairosTimeFrame</span><span class="p">,</span>
      <span class="p">(</span><span class="s1">&#39;function&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">require</span> <span class="o">&amp;&amp;</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./kairos_errors&#39;</span><span class="p">))</span>                     <span class="o">||</span> <span class="nx">exports</span><span class="p">.</span><span class="nx">KairosErrors</span>    <span class="o">||</span> <span class="nx">KairosErrors</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}(</span>
  <span class="s1">&#39;object&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">exports</span> <span class="o">&amp;&amp;</span> <span class="nx">exports</span> <span class="o">||</span> <span class="k">this</span><span class="p">,</span>
  <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10000000</span> <span class="o">+</span> <span class="mi">10000000</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>
<span class="p">));</span></div></div></div></div></body></html>